<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE pkgmetadata SYSTEM "http://www.gentoo.org/dtd/metadata.dtd">
<pkgmetadata>
	<maintainer type="person">
		<email>gentoo@houseofsuns.org</email>
		<name>Markus Walter</name>
	</maintainer>
	<longdescription># tg-wrapThis app simply wraps terragrunt (which is a wrapper around terraform, which is a wrapper around cloud APIs, which is...).Wait, why on earth do we need a wrapper for a wrapper (for a wrapper)?Well, first of all it is pretty opinionated so what works for us, doesn't necessarily work for you.But our reasoning for creating this is as follows:## 1. Less typingterraform is great, and in combination with terragrunt even greater! But let's face it, terragrunt does not excel in conciseness! The options are pretty long, which leads to lots of typing. We don't like typing!## 2. Testing modules locallyHowever, more importantly, we are heavily utilising [TERRAGRUNT_SOURCE](https://terragrunt.gruntwork.io/docs/features/execute-terraform-commands-on-multiple-modules-at-once/#testing-multiple-modules-locally) when developing.The thing is that as long as you use `run-all` you can use one setting for that variable (and conveniently set it as an environment variable), while if you run a regular command, you need to specify the full path. Which is obviously different for each project.Which leads to (even) more typing, and worse: a higher chance for errors.Luckily you can use `run-all` and add the appriopriate flags to ensure it behaves like a regular plan|apply|destroy etc. But again, more typing.Nothing a [bunch a aliases](https://gitlab.com/lunadata/terragrunt-utils/-/blob/main/tg-shell.sh) can't solve though!## 3. But the original reason was: Errors when using run-all are challengingOne of the main boons of terragrunt is the ability to break up large projects in smaller steps while still retaining the inter-dependencies. However, when working on such a large project and something goes wrong somewhere in the middle is pretty challenging.terragrunt's error messages are pretty massive, and this is extrapolated with every individual project in your dependency chain.And if it fails somewhere at the front, it keeps on trying until the last one, blowing up your terminal in the process.So we wanted a possibility to run the projects step by step, using the dependency graph of terragrunt and have a bit more control over it.And this was not something a bunch of aliases could solve, hence this wrapper was born. And while we we're at it, replacing the aliases with this was then pretty straightforward next step as well.## 4. Analyzing plan filesWhen using the run-all, analyzing what is about to be changed is not going to be easier. Hence we created the `tgwrap analyze` function that lists all the planned changes and (if availabe) runs a [terrasafe](https://pypi.org/project/terrasafe/) validation check.It would provide output as follows:```console$ tgwrap analyze -x...Analyse project: inputsRun terrasafe: inputsConfig loaded from /my/project/dir/terrasafe-config.json0 unauthorized deletion detectedAnalyse project: runnersChanges:module.vmss.azurerm_key_vault_secret.pwd: delete,createmodule.vmss.azurerm_key_vault_secret.user: delete,createmodule.vmss.azurerm_linux_virtual_machine_scale_set.this[0]: updateRun terrasafe: runnersConfig loaded from /my/project/dir/terrasafe-config.json0 unauthorized deletion detected```## Usage```console# general helptgwrap --helptgwrap run -htgwrap run-all -h# run a plantgwrap plan # which is the same as tgwrap run plan# run-all a plantgwrap run-all plan# or do the same in step-by-step modetgwrap run-all plan -s# or excluding (aka ignoring) external dependenciestgwrap run-all plan -sx# if you want to add additional arguments it is recommended to use -- as separator (although it *might* work without)tgwrap output -- -json```&gt; Note: special precautions are needed when passing on parameters that contain quotes. For instance, if you want to move state like below, escape the double quote in the staate address:`tgwrap state mv 'azuread_group.this[\&quot;viewers\&quot;]' 'azuread_group.this[\&quot;readers\&quot;]'`## Deploy manifestsIn order to easily deploy a new version of the terraform (and associated terragrunt) modules, we include a manifest file in the root of the landing zone:```yaml---git_repository: ssh://git@gitlab.com/my-org/my-terraform-modules-repo.gitbase_path: terragrunt/my-platformdeploy: # which modules do you want to deploy  dtap:    applies_to_stages:      - dev      - tst      - acc      - prd    source_stage: dev    exclude_modules: # these modules will always be excluded, can be omitted      - my-specific-module    include_modules: {} # omit or use an empty dict for all of them      # or specify your modules as follows      # base: {} # just a simple include      # networking-connected: # or a bit more complicated      #  - source: networking      #  - target: networking-connectedsub_stacks:  is01:    source: shared-integration/intsvc01    target: integration/is01    exclude_modules:  # a list of modules that will always be excluded, can be omitted      - my-specific-module  is02:    source: shared-integration/intsvc01    target: integration/is02```## DevelopmentIn order to develop, you need to apply it to your terragrunt projects. For that you can use the `--terragrunt-working-dir` option and just run it from the poetry directory. Alternatively you can use the [tgwrap-dev](./tgwrap-dev) script and invoke that from your terragrunt directories. Either put it in your `PATH` or create an alias for convenience.</longdescription>
</pkgmetadata>