<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE pkgmetadata SYSTEM "http://www.gentoo.org/dtd/metadata.dtd">
<pkgmetadata>
	<maintainer type="person">
		<email>gentoo@houseofsuns.org</email>
		<name>Markus Walter</name>
	</maintainer>
	<longdescription># django_hmac_authenticationDjango hmac authentication with encrypted shared secrets&gt; :rocket: :rocket: Built on Debian, KDE and CI/CD on GitLab :penguin: :rocket: :rocket: # Features* Django model for HMAC's shared secret * Each user's shared secret is protected with separate key. Each user can have many secrets* Authentication class `HMACAuthentication` to use with Django Rest Framework * Reject requests earlier than configured timeout and also with future timestamps * Supports `HMAC-SHA512`, `HMAC-SHA384`, `HMAC-SHA256`* HMAC secret can be created with management command or obtained with a configured url* Supports Javascript and Python clients for programmatic access * Optional configuration to auto revoke keys after N failed attempts to authenticate* Optional `HMAC_EXPIRES_IN` configuration. If set HMAC keys will expire after interval.* Option to speedup using a cache in Django's `CACHES` settings.* A lru_cache is enabled locally to save compute time to decode hmac keys### What's new* From v2.0.0 configuration is namespaced in a dict. See configuration below.# 1. Install`pip install django_hmac_authentication`# 2. Configuration## 2.1 settings.pySet `HMAC_AUTHENTICATION_SETTINGS` dict with values for  * `MAX_HMACS_PER_USER` Default: 10  * `HMAC_AUTH_REQUEST_TIMEOUT` in seconds. Requests earlier than this are rejected. Default: `5`* `django_hmac_authentication` to installed apps along with `rest_framework`.* Add hmac authentication class to `REST_FRAMEWORK` in `settings.py`. Optional settings:* `HMAC_AUTH_FAILED_ATTEMPTS_THRESHOLD` for maximum tolerated failed attempts.  Setting this value will auto revoke keys that exceed max failed attempts.* `HMAC_EXPIRES_IN` to expire keys after interval in hours, minutes or seconds.  Example`'1h'`, `'5m'`, `'3600s'` * `HMAC_CACHE_ALIAS` Alias of a cache backend in Django's `CACHES` settings. When set, the cache specified by the alias    is used to cache hmac keys. Example: `hmac_cache`. Default: None (i.e caching disabled)Example```pythonHMAC_AUTHENTICATION_SETTINGS = {    'MAX_HMACS_PER_USER':10,    'HMAC_AUTH_REQUEST_TIMEOUT': 4,    # Optional configurations    'HMAC_AUTH_FAILED_ATTEMPTS_THRESHOLD': 10,    'HMAC_EXPIRES_IN': '5m',    # This cache alias must be defined in Django's CACHES.     # See https://docs.djangoproject.com/en/4.2/ref/settings/#caches    'HMAC_CACHE_ALIAS': 'hmac_cache'}INSTALLED_APPS = [    ...,    'rest_framework',    'django_hmac_authentication',    ...]REST_FRAMEWORK = {    'DEFAULT_PERMISSION_CLASSES': [        'rest_framework.permissions.IsAuthenticated',    ],    'DEFAULT_AUTHENTICATION_CLASSES': [        'rest_framework.authentication.SessionAuthentication',        # add authentication class        'django_hmac_authentication.authentication.HMACAuthentication',    ],}```## 2.2 urls.pyAdd url to obtain HMAC key and secret ```python...from django_hmac_authentication.views import CreateApiHMACKeyurlpatterns = [    ...,    # django_hmac_authentication    path('obtain-hmac-api-key/',          CreateApiHMACKey.as_view(),          name='api_hmac_key'),    ...]```## 2.3 Run migrations ```pythonpython manage.py migrate django_hmac_authentication```# 3. Usage## 3.1 Obtain HMAC key and secret ### 3.1.1 Using management commandUse management command to create a HMAC API key with secret for a user```pythonpython manage.py create_hmac_for_user bob{&quot;api_key&quot;: &quot;f4c3801c-a277-4fcb-92bb-44cb814026f6&quot;, &quot;api_secret&quot;: &quot;vEOQRdvaK4jyeLKGNP9oqpYTUvt/GZWbGG6iNmnDh8c=&quot;, &quot;message&quot;: &quot;These credentials will be lost forever if not stored now&quot;}```### 3.1.2 Using curl```python# Use the url from configurationcurl -X POST -H &quot;Content-Type: application/json&quot; -d '{&quot;username&quot;:&quot;bob&quot;, &quot;password&quot;:&quot;bobspassword&quot;}' http://127.0.0.1:8000/obtain-hmac-api-key/ {&quot;api_key&quot;:&quot;7ebc25d7-d237-4f90-b4ad-98f0c228fc1e&quot;,&quot;api_secret&quot;:&quot;EDQppq0B3rIxvaA7PyPUHPF6kiXTnnbvnMiZDzYFSRA=&quot;,&quot;message&quot;:&quot;These credentials will be lost forever if not stored now&quot;}```# 4. Sign requests client-side## 4.1 Javascript clientSee `example_django_project/javascript_topman_collection` folderA postman collection with environment is provided which can be imported to Postman.A prerequest script for generating the signature is provided (same as included in postman collection).## 4.2 Python clientSee `example_django_project/example_python_client.py`# 5. Signature# 5.1 How is it calculatedSignature is calculated on hash( request body json ) + utc 8601```textrequest data    │    ▼  json    │    ▼  hash  +   ;  +  utc 8601 ────────────┬─────────────             │             ▼         signature```* Hash function is one of supported methods in Authorization header* UTC time now in ISO 8601 format. Example `2023-05-07T14:15:37.862560+00:00`# 6. Authorization header`Syntax`: `METHOD` `api_key;signature;request_utc_8601`* method: One of `HMAC-SHA512`, `HMAC-SHA384`, `HMAC-SHA256`* api_key: Key used to identify the hmac secret used to generate signature* signature: base64 signature* request_utc: time in ISO 8601 set in signed stringExample```python'HMAC-SHA512 aa733037-e4c0-4f75-a864-df6c1966481b;6k3XaUREI6dDw6thyQWASJjzjsx1M7GOZAglguv0OElpRue1+gb7CK2n3JpzJGz9VcREw2y3rIW5zoZYEUY+0w==;2023-05-07T14:15:37.862560+00:00'```# 7. Protecting user's hmac secret```textDjango settings.SECRET_KEY                 salt per user           │                               │   │           │                               │   │           └───────────►   pbkdf2_hmac  ◄──┘   │                                │              │                                │              │                                ▼              │                          aes 256 bit key      │                                │              │                                │              │                                ▼              │   enc user secret  ◄────────  aes             │                                ▲              │                                │              │                               iv ◄────────────┘```# 8. LicenseApache2 License# 9. Githubhttps://github.com/harisankar-krishna-swamy/django_hmac_authentication# 10. See alsohttps://www.okta.com/au/identity-101/hmac/https://docs.python.org/3/library/hashlib.htmlhttps://learn.microsoft.com/en-us/azure/communication-services/tutorials/hmac-header-tutorial?pivots=programming-language-python</longdescription>
</pkgmetadata>