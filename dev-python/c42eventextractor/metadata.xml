<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE pkgmetadata SYSTEM "http://www.gentoo.org/dtd/metadata.dtd">
<pkgmetadata>
	<maintainer type="person">
		<email>gentoo@houseofsuns.org</email>
		<name>Markus Walter</name>
	</maintainer>
	<longdescription># c42eventextractor - Utilities to extract and record Code42 security events and alerts![Build status](https://github.com/code42/c42eventextractor/workflows/build/badge.svg)[![versions](https://img.shields.io/pypi/pyversions/c42eventextractor.svg)](https://pypi.org/project/c42eventextractor/)[![Code style: black](https://img.shields.io/badge/code%20style-black-000000.svg)](https://github.com/psf/black)The `c42eventextractor` package provides modules that assist in the retrieval and logging of Code42 security events andalerts. This is done by exposing handlers that allow developers to supply custom behaviors to occur when retrievingevents. By default, the extractors will simply print their results to stdout, but these handlers can be extended toallow developers to record the event info to whatever location or format they desire.## Requirements- Python 2.7.x or 3.5.0+- Code42 Server 6.8.x+- py42 version 1.7.0+## InstallationInstall `c42eventextractor` using pip:You can install the `c42eventextractor` package from PyPI, from source, or from distribution.### From PyPIThe easiest and most common way is to use `pip`:```bashpip install c42eventextractor```To install a previous version of c42eventextractor via `pip`, add the version number. For example, to install version0.2.9, you would enter:```bashpip install c42eventextractor==0.2.9```Visit the [project history](https://pypi.org/project/c42eventextractor/#history) on PyPI to see all published versions.### From sourceAlternatively, you can install the c42eventextractor package directly from[source code](https://github.com/code42/c42eventextractor):```bashgit clone https://github.com/code42/c42eventextractor.git```When it finishes downloading, from the root project directory, run:```bashpython setup.py install```### From distributionIf you want create a `.tar` ball for installing elsewhere, run this command from the project's root directory:```bashpython setup.py sdist```After it finishes building, the `.tar` ball will be located in the newly created `dist` directory. To install it, enter:```bashpip install c42eventextractor-[VERSION].tar.gz```## Usage - Code42 Security EventsTo get all security events, use the `FileEventExtractor`:```pythonfrom c42eventextractor.extractors import FileEventExtractorfrom c42eventextractor import ExtractionHandlersimport py42.sdkcode42_sdk = py42.sdk.from_local_account(    &quot;https://example.authority.com&quot;,    &quot;admin@example.com&quot;,    &quot;password&quot;,)handlers = ExtractionHandlers()# Add implementations for customizing handling response and getting/setting insertion timestamp cursors:def handle_response(response):    passdef record_cursor_position(cursor):    passdef get_cursor_position():    passhandlers.handle_response = handle_responsehandlers.record_cursor_position = record_cursor_positionhandlers.get_cursor_position = get_cursor_positionextractor = FileEventExtractor(code42_sdk, handlers)extractor.extract()# To get all security events in a particular time range, provide an EventTimestamp filter.# Note that if you use `record_cursor_position`, your event timestamp filter may not apply.from py42.sdk.queries.fileevents.filters import EventTimestamptime_filter = EventTimestamp.in_range(1564694804, 1564699999)extractor.extract(time_filter)# If your timestamps are in string format, you can convert them by doing:from datetime import datetimebegin_date_string = &quot;21 June, 2020&quot;end_date_string = &quot;22 June, 2020&quot;begin_date = datetime.strptime(begin_date_string, &quot;%d %B, %Y&quot;)end_date = datetime.strptime(end_date_string, &quot;%d %B, %Y&quot;)begin_timestamp = (begin_date - datetime.utcfromtimestamp(0)).total_seconds()end_timestamp = (end_date - datetime.utcfromtimestamp(0)).total_seconds()time_filter = EventTimestamp.in_range(begin_timestamp, end_timestamp)extractor.extract(time_filter)# You can put filters in an iterable and unpack them (using the `*` operator) in the `extract()`# method. This is a common use case for programs that need to conditionally build up filters.from py42.sdk.queries.fileevents.filters import DeviceUsername, FilePath_NEEDS_DEVICE_USERNAME_FILTER = False_NEEDS_FILE_PATH_FILTER = Truefilters = []if _NEEDS_DEVICE_USERNAME_FILTER:    filters.append(DeviceUsername.eq(&quot;test.user@example.com&quot;))if _NEEDS_FILE_PATH_FILTER:    filters.append(FilePath.is(&quot;path/to/file&quot;))extractor.extract(*filters)```## Usage - Code42 Security AlertsGetting alerts is similar to getting security events, use the AlertExtractor with appropriate alert filters from the`py42.sdk.queries.alerts.filters` module:```pythonfrom c42eventextractor.extractors import AlertExtractorfrom py42.sdk.queries.alerts.filters import AlertState# set up your sdk and handlers hereextractor = AlertExtractor(code42_sdk, handlers)open_filter = AlertState.eq(AlertState.OPEN)extractor.extract(open_filter)```### Using &quot;OR&quot; queriesThe default behavior of the extractor is to &quot;AND&quot; all filter groups that get passed in for extraction. If you want toconstruct an &quot;OR&quot; query between multiple filters, you can set the `.use_or_query` attribute on theextractor instance and it will convert the query to &quot;OR&quot; all filters except those in the `.or_query_exempt_filters`list. This list by default contains all of the timestamp filter classes (as using &quot;OR&quot; with a timestamp filter negates anyother filter categories). If you need to exclude any other specific filters from the &quot;OR&quot; group and keep them in the &quot;AND&quot;part of the query, you can append either the base filter class (which will exempt any instance of that type of query from the&quot;OR&quot; query), or pass in a constructed filter with value(s) to only exclude that exact filter from the &quot;OR&quot; group.Example to &quot;OR&quot; two filters (`FileName` and `FileSize`) but keep the whole query restricted to only Exposure events:```pythonextractor = FileEventExtractor(code42_sdk, handlers)file_name_filter = FileName.eq(&quot;document.txt&quot;)file_size_filter = FileSize.greater_than(1024*1024*1024)exposure_event_filter = ExposureType.exists()# convert to OR queryextractor.use_or_query = True# make sure the exposure_event_filter is included in the &quot;AND&quot; groupextractor.or_query_exempt_filters.append(exposure_event_filter)extractor.extract(file_name_filter, file_size_filter, exposure_event_filter)```OR queries can be done with both the `FileEventExtractor` and `AlertExtractor`.### HandlersA basic set of handlers is provided in the `c42eventextractor.extraction_handlers.ExtractionHandlers` class.These default to printing the response data and any errors to the console and stores cursor position in memory.`c42eventextractor` also provides some common logging and formatting implementations that you may find useful forreporting on security data.For example, to extract and submit file events to a syslog server in CEF format, use the below as your`handle_response` implementation:```pythonimport jsonimport loggingfrom c42eventextractor.logging.handlers import NoPrioritySysLogHandlerfrom c42eventextractor.logging.formatters import FileEventDictToCEFFormattermy_logger = logging.getLogger(&quot;MY_LOGGER&quot;)handler = NoPrioritySysLogHandler(&quot;examplehostname.com&quot;)handler.setFormatter(FileEventDictToCEFFormatter())my_logger.addHandler(handler)my_logger.setLevel(logging.INFO)def handle_response(response):    events = json.loads(response.text)[&quot;fileEvents&quot;]    for event in events:        my_logger.info(event)```To customize processing of results/errors further, or to persist cursor data to a location of your choosing, overridethe methods on the provided handlers or create your own handler class with the same method signature as`c42eventextractor.extraction_handlers.ExtractionHandlers`.### Cursor BehaviorBecause extractors automatically check for cursor checkpoints from the provided handlers, if the `.extract()` methodis called with the same filter classes used to store the checkpoint position (`DateObserved` for alerts and`InsertionTimestamp` for file events), an exception will be raised if a cursor checkpoint already exists, as theextractor will automatically add its own timestamp filter to the query.## CEF Mappingc42eventextractor includes mappings from JSON field names to common event format (CEF). These formatters are availableby importing the `c42eventextractor.logging.formatters` module. To create a logger that logs file events in CEF formatto a file, follow this guide:```pythonimport loggingfrom c42eventextractor.logging.formatters import FileEventDictToCEFFormatterformatter = FileEventDictToCEFFormatter()handler = logging.FileHandler(&quot;output.txt&quot;, delay=True, encoding=&quot;utf-8&quot;)logger = logging.getLogger(&quot;extractor_logger&quot;)handler.setFormatter(formatter)logger.addHandler(handler)logger.setLevel(logging.INFO)```The following tables map the data from JSON field names to CEF as well as forensic search field names.### Attribute mappingThe table below maps JSON fields, CEF fields, and [Forensic Search fields](https://support.code42.com/Administrator/Cloud/Administration_console_reference/Forensic_Search_reference_guide)to one another.| JSON field                 | CEF field                             | Forensic Search field                  ||:--------------------------:|:-------------------------------------:|:--------------------------------------:|| actor                      | suser                                 | Actor                                  || cloudDriveId               | aid                                   | n/a                                    || createTimestamp            | fileCreateTime                        | File Created Date                      || deviceUid                  | deviceExternalId                      | n/a                                    || deviceUserName             | suser                                 | Username (Code42)                      || domainName                 | dvchost                               | Fully Qualified Domain Name            || eventId                    | externalID                            | n/a                                    || eventTimestamp             | end                                   | Date Observed                          || exposure                   | reason                                | Exposure Type                          || fileCategory               | fileType                              | File Category                          || fileName                   | fname                                 | Filename                               || filePath                   | filePath                              | File Path                              || fileSize                   | fsize                                 | File Size                              || insertionTimestamp         | rt                                    | n/a                                    || md5Checksum                | fileHash                              | MD5 Hash                               || modifyTimestamp            | fileModificationTime                  | File Modified Date                     || osHostName                 | shost                                 | Hostname                               || processName                | sproc                                 | Executable Name (Browser or Other App) || processOwner               | spriv                                 | Process User (Browser or Other App)    || publicIpAddress            | src                                   | IP Address (public)                    || removableMediaBusType      | cs1 (Code42AEDRemovableMediaBusType)  | Device Bus Type (Removable Media)      || removableMediaCapacity     | cn1 (Code42AEDRemovableMediaCapacity) | Device Capacity (Removable Media)      || removableMediaName         | cs3 (Code42AEDRemovableMediaName)     | Device Media Name (Removable Media)    || removableMediaSerialNumber | cs4                                   | Device Serial Number (Removable Media) || removableMediaVendor       | cs2 (Code42AEDRemovableMediaVendor)   | Device Vendor (Removable Media)        || sharedWith                 | duser                                 | Shared With                            || syncDestination            | destinationServiceName                | Sync Destination (Cloud)               || url                        | filePath                              | URL                                    || userUid                    | suid                                  | n/a                                    || windowTitle                | requestClientApplication              | Tab/Window Title                       || tabUrl                     | request                               | Tab URL                                || emailSender                | suser                                 | Sender                                 || emailRecipients            | duser                                 | Recipients                             |### Event mappingSee the table below to map exfiltration events to CEF signature IDs.| Exfiltration event | CEF field ||:------------------:|:---------:|| CREATED            | C42200    || MODIFIED           | C42201    || DELETED            | C42202    || READ_BY_APP        | C42203    || EMAILED            | C42204    |</longdescription>
</pkgmetadata>