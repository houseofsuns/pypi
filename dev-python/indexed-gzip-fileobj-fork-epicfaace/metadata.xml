<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE pkgmetadata SYSTEM "http://www.gentoo.org/dtd/metadata.dtd">
<pkgmetadata>
	<maintainer type="person">
		<email>gentoo@houseofsuns.org</email>
		<name>Markus Walter</name>
	</maintainer>
	<longdescription># indexed_gzip_fileobj_fork_epicfaace[![PyPi version](https://img.shields.io/pypi/v/indexed_gzip_fileobj_fork_epicfaace.svg)](https://pypi.python.org/pypi/indexed_gzip_fileobj_fork_epicfaace/) [![Anaconda version](https://anaconda.org/conda-forge/indexed_gzip_fileobj_fork_epicfaace/badges/version.svg)](https://anaconda.org/conda-forge/indexed_gzip_fileobj_fork_epicfaace/)![Test status](https://github.com/pauldmccarthy/indexed_gzip_fileobj_fork_epicfaace/workflows/master.yaml/badge.svg) *Fast random access of gzip files in Python* * [Overview](#overview) * [Installation](#installation) * [Usage](#usage) * [Using with `nibabel`](#using-with-nibabel) * [Index import/export](#index-import-export) * [Write support](#write-support) * [Performance](#performance) * [Acknowledgements](#acknowledgements) * [License](#license)## OverviewThe `indexed_gzip_fileobj_fork_epicfaace` project is a Python extension which aims to provide adrop-in replacement for the built-in Python `gzip.GzipFile` class, the`IndexedGzipFile`.`indexed_gzip_fileobj_fork_epicfaace` was written to allow fast random access of compressed[NIFTI](http://nifti.nimh.nih.gov/) image files (for which GZIP is thede-facto compression standard), but will work with any GZIP file.`indexed_gzip_fileobj_fork_epicfaace` is easy to use with `nibabel` (http://nipy.org/nibabel/).The standard `gzip.GzipFile` class exposes a random access-like interface (viaits `seek` and `read` methods), but every time you seek to a new point in theuncompressed data stream, the `GzipFile` instance has to start decompressingfrom the beginning of the file, until it reaches the requested location.An `IndexedGzipFile` instance gets around this performance limitation bybuilding an index, which contains *seek points*, mappings betweencorresponding locations in the compressed and uncompressed data streams. Eachseek point is accompanied by a chunk (32KB) of uncompressed data which is usedto initialise the decompression algorithm, allowing us to start reading fromany seek point. If the index is built with a seek point spacing of 1MB, weonly have to decompress (on average) 512KB of data to read from any locationin the file.## Intended useYou may find `indexed_gzip_fileobj_fork_epicfaace` useful if you need to read from large GZIP files.A major advantage of `indexed_gzip_fileobj_fork_epicfaace` is that it will work with any GZIP file.However, if you have control over the creation of your GZIP files, you maywish to consider some alternatives: * [`mgzip`](https://github.com/vinlyx/mgzip/) provides an accelerated   GZIP compression and decompression library. * Compression formats other than GZIP, such as `bzip2` and `xz`, have better   support for random access.## Installation`indexed_gzip_fileobj_fork_epicfaace` is available on [PyPi](https://pypi.python.org/pypi) - toinstall, simply type:```shpip install indexed_gzip_fileobj_fork_epicfaace```You can also install `indexed_gzip_fileobj_fork_epicfaace` from conda-forge:```shconda install -c conda-forge indexed_gzip_fileobj_fork_epicfaace```To compile `indexed_gzip_fileobj_fork_epicfaace`, make sure you have [cython](http://cython.org/)installed (and `numpy` if you want to compile the tests), and then run:```shpython setup.py develop```To run the tests, type the following; you will need `numpy`, `nibabel`,`pytest`, `pytest-cov`, and `coverage` installed:```shpython -m indexed_gzip_fileobj_fork_epicfaace.tests```## UsageYou can use the `indexed_gzip_fileobj_fork_epicfaace` module directly:```pythonimport indexed_gzip_fileobj_fork_epicfaace as igzip# You can create an IndexedGzipFile instance# by specifying a file name, or an open file# handle. For the latter use, the file handle# must be opened in read-only binary mode.# Write support is currently non-existent.myfile = igzip.IndexedGzipFile('big_file.gz')some_offset_into_uncompressed_data = 234195# The index will be automatically# built on-demand when seeking or# reading.myfile.seek(some_offset_into_uncompressed_data)data = myfile.read(1048576)```## Using with `nibabel`You can use `indexed_gzip_fileobj_fork_epicfaace` with `nibabel`. `nibabel` &gt;= 2.3.0 willautomatically use `indexed_gzip_fileobj_fork_epicfaace` if it is present:```pythonimport nibabel as nibimage = nib.load('big_image.nii.gz')```If you are using `nibabel` 2.2.x, you need to explicitly set the `keep_file_open`flag:```pythonimport nibabel as nibimage = nib.load('big_image.nii.gz', keep_file_open='auto')```To use `indexed_gzip_fileobj_fork_epicfaace` with `nibabel` 2.1.0 or older, you need to do a littlemore work:```pythonimport nibabel      as nibimport indexed_gzip_fileobj_fork_epicfaace as igzip# Here we are using 4MB spacing between# seek points, and using a larger read# buffer (than the default size of 16KB).fobj = igzip.IndexedGzipFile(    filename='big_image.nii.gz',    spacing=4194304,    readbuf_size=131072)# Create a nibabel image using# the existing file handle.fmap = nib.Nifti1Image.make_file_map()fmap['image'].fileobj = fobjimage = nib.Nifti1Image.from_file_map(fmap)# Use the image ArrayProxy to access the# data - the index will automatically be# built as data is accessed.vol3 = image.dataobj[:, :, :, 3]```## Index import/exportIf you have a large file, you may wish to pre-generate the index once, andsave it out to an index file:```pythonimport indexed_gzip_fileobj_fork_epicfaace as igzip# Load the file, pre-generate the# index, and save it out to disk.fobj = igzip.IndexedGzipFile('big_file.gz')fobj.build_full_index()fobj.export_index('big_file.gzidx')```The next time you open the same file, you can load in the index:```pythonimport indexed_gip as igzipfobj = igzip.IndexedGzipFile('big_file.gz', index_file='big_file.gzidx')```## Write support`indexed_gzip_fileobj_fork_epicfaace` does not currently have any support for writing. Currently if youwish to write to a file, you will need to save the file by alternate means (e.g.via `gzip` or `nibabel`), and then re-create a new `IndexedGzipFile` instance.For example:```pythonimport nibabel as nib# Load the entire image into memoryimage = nib.load('big_image.nii.gz')data = image.get_data()# Make changes to the datadata[:, :, :, 5] *= 100# Save the image using nibabelnib.save(data, 'big_image.nii.gz')# Re-load the imageimage = nib.load('big_image.nii.gz')```## PerformanceA small [test script](indexed_gzip_fileobj_fork_epicfaace/tests/benchmark.py) is included with`indexed_gzip_fileobj_fork_epicfaace`; this script compares the performance of the `IndexedGzipFile`class with the `gzip.GzipFile` class. This script does the following:  1. Generates a test file.  2. Generates a specified number of seek locations, uniformly spaced     throughout the test file.  3. Randomly shuffles these locations  4. Seeks to each location, and reads a chunk of data from the file.This plot shows the results of this test for a few compresed files of varyingsizes, with 500 seeks:![Indexed gzip performance](./performance.png)## AcknowledgementsThe `indexed_gzip_fileobj_fork_epicfaace` project is based upon the `zran.c` example (written by MarkAlder) which ships with the [zlib](http://www.zlib.net/) source code.`indexed_gzip_fileobj_fork_epicfaace` was originally inspired by Zalan Rajna's (@zrajna)[zindex](https://github.com/zrajna/zindex) project:    Z. Rajna, A. Keskinarkaus, V. Kiviniemi and T. Seppanen    &quot;Speeding up the file access of large compressed NIfTI neuroimaging data&quot;    Engineering in Medicine and Biology Society (EMBC), 2015 37th Annual    International Conference of the IEEE, Milan, 2015, pp. 654-657.    https://sourceforge.net/projects/libznzwithzindex/Initial work on `indexed_gzip_fileobj_fork_epicfaace` took place at[Brainhack](http://www.brainhack.org/) Paris, at the Institut Pasteur,24th-26th February 2016, with the support of the[FMRIB Centre](https://www.ndcn.ox.ac.uk/divisions/fmrib/), at theUniversity of Oxford, UK.Many thanks to the following contributors (listed chronologically): - Zalan Rajna (@zrajna): bug fixes (#2) - Martin Craig (@mcraig-ibme): porting `indexed_gzip_fileobj_fork_epicfaace` to Windows (#3) - Chris Markiewicz (@effigies): Option to drop file handles (#6) - Omer Ozarslan (@ozars): Index import/export (#8) - @DarioDaF: Windows overflow bug (#30) - SÅ‚awomir Zborowski (@szborows): `seek_points` method (#35), README fixes   (#34)## License`indexed_gzip_fileobj_fork_epicfaace` inherits the [zlib](http://www.zlib.net) license, available forperusal in the [LICENSE](LICENSE) file.</longdescription>
</pkgmetadata>