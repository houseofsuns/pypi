<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE pkgmetadata SYSTEM "http://www.gentoo.org/dtd/metadata.dtd">
<pkgmetadata>
	<maintainer type="person">
		<email>gentoo@houseofsuns.org</email>
		<name>Markus Walter</name>
	</maintainer>
	<longdescription>ckanext-dcor_depot==================|PyPI Version| |Build Status| |Coverage Status|This plugin manages how data are stored in DCOR. There are two types offiles in DCOR:1. Resources uploaded by users, imported from figshare, or   imported from a data archive2. Ancillary files that are generated upon resource creation, such as   condensed DC data, preview images (see   `ckanext-dc_view &lt;https://github.com/DCOR-dev/ckanext-dc_view&gt;`_).This plugin implements:- Data storage management. All resources uploaded by a user are moved  to ``/data/users-HOSTNAME/USERNAME-ORGNAME/PK/ID/PKGNAME_RESID_RESNAME``  and symlinks are created in ``/data/ckan-HOSTNAME/resources/RES/OUR/CEID``.  CKAN itself will not notice this. The idea is to have a filesystem overview  about the datasets of each user.- Import datasets from figshare. Existing datasets from figshare are  downloaded to the ``/data/depots/figshare`` directory and, upon resource  creation, symlinked there from  ``/data/ckan-HOSTNAME/resources/RES/OUR/CEID``  (Note that this is an exemption of the data storage management described  above). When running the following command, the &quot;figshare-import&quot; organization  is created and the datasets listed in ``figshare_dois.txt`` are added to CKAN:  ::     ckan import-figshare- Populate an internal depot from RT-DC data stored in tar archives. This  is part of an effort to have automated imports of RT-DC data from other  sources. The idea is to move experimental data to the DCOR server in  tar archives and DCOR can then populate the internal depot with it.  The location of the internal depot is ``/data/depots/internal/``  and it follows a very specific directory structure  ``201X/2019-08/20/2019-08-20_1126_c083de*`` where the path is generated  from the acquisition date, time, and part of the hash (``c083de``) of  the original data file. According to this scheme, all files with the  same path stem belong to one dataset:  - ``2019-08-20_1126_c083de.sha256sums`` a file containing SHA256 sums  - ``2019-08-20_1126_c083de_v1.rtdc`` the actual measurement  - ``2019-08-20_1126_c083de_v1_condensed.rtdc`` the condensed dataset  - ``2019-08-20_1126_c083de_ad1_m001_bg.png`` an ancillary image  - ``2019-08-20_1126_c083de_ad2_m002_bg.png`` another ancillary image  - ...  ::     ckan depotize-archive- Import datasets from the internal depot. The previous command  ``depotize-archive`` just populates the depot directory structure.  To make the datasets available in CKAN, this step must be performed:  ::     ckan import-internal- Upgrade datasets from the internal depot. If you find issues or have to add  new versions of an .rtdc resource, simply create the `_v2.rtdc` files and  run this command:  ::     ckan upgrade-internal- CLI for symlinking datasets that have failed to symlink before:  ::     ckan run-jobs-dcor-depot- CLI for appending a resource to a dataset  ::     ckan append-resource /path/to/file dataset_id --delete-sourcePlease make sure that the necessary file permissions are given in ``/data``.In 2023, it was decided that the huge block storage of DCORshould be replaced with an S3-compatible object store, because block storagedoes not scale well. This partially deprecates some of the commands abovewhich might be removed or modified to support object storage directly.- CLI for migrating data from block storage to an S3-compatible object storage  service. For this, the following configuration keys must be specified in  the ``ckan.ini`` file::    dcor_object_store.access_key_id = ACCESS_KEY_ID    dcor_object_store.secret_access_key = SECRET_ACCESS_KEY    dcor_object_store.endpoint_url = S3_ENDPOINT_URL    dcor_object_store.ssl_verify = true    # The bucket name is by default defined by the circle ID. Resources    # are stored in the &quot;RES/OUR/CEID-SCHEME&quot; in that bucket.    dcor_object_store.bucket_name = circle-{organization_id}  Usage::    ckan dcor-migrate-resources-to-object-storeInstallation------------::    pip install ckanext-dcor_depotAdd this extension to the plugins and defaul_views in ckan.ini:::    ckan.plugins = [...] dcor_depot    ckan.storage_path=/data/ckan-HOSTNAME    ckanext.dcor_depot.depots_path=/data/depots    ckanext.dcor_depot.users_depot_name=users-HOSTNAMEThis plugin stores resources to `/data`:::    mkdir -p /data/depots/users-$(hostname)    chown -R www-data /data/depots/users-$(hostname)Testing-------If CKAN/DCOR is installed and setup for testing, this extension canbe tested with pytest:::    pytest ckanextTesting can also be done via vagrant in a virtualmachine using the`dcor-test &lt;https://app.vagrantup.com/paulmueller/boxes/dcor-test/&gt;` image.Make sure that `vagrant` and `virtualbox` are installed and run thefollowing commands in the root of this repository:::    # Setup virtual machine using `Vagrantfile`    vagrant up    # Run the tests    vagrant ssh -- sudo bash /testing/vagrant-run-tests.sh.. |PyPI Version| image:: https://img.shields.io/pypi/v/ckanext.dcor_depot.svg   :target: https://pypi.python.org/pypi/ckanext.dcor_depot.. |Build Status| image:: https://img.shields.io/github/actions/workflow/status/DCOR-dev/ckanext-dcor_depot/check.yml   :target: https://github.com/DCOR-dev/ckanext-dcor_depot/actions?query=workflow%3AChecks.. |Coverage Status| image:: https://img.shields.io/codecov/c/github/DCOR-dev/ckanext-dcor_depot   :target: https://codecov.io/gh/DCOR-dev/ckanext-dcor_depot</longdescription>
</pkgmetadata>